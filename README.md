# Workbench

Workbench is a .NET CLI for managing Workbench documentation, work items, and
contracts in this repo.

## Repository map

- `src/Workbench`: CLI source code.
- `tests/`: automated tests.
- `docs/`: product, architecture, contracts, decisions, and runbooks.
- `docs/70-work/`: active and completed work items plus templates.
- `assets/`: static assets used by docs or tooling.
- `artifacts/`: build outputs and local artifacts.
- `testdata/`: fixtures for parsing and validation tests.

## Requirements

- .NET SDK `10.0.100` (see `global.json`).
- Optional: GitHub CLI for the GH-dependent integration tests.

## Common commands

Build the solution:

```bash
dotnet build Workbench.slnx
```

Run the CLI:

```bash
dotnet run --project src/Workbench/Workbench.csproj -- --help
```

Run tests:

```bash
dotnet test Workbench.slnx
```

Run unit tests only:

```bash
dotnet test tests/Workbench.Tests/Workbench.Tests.csproj
```

Run integration tests:

```bash
dotnet test tests/Workbench.IntegrationTests/Workbench.IntegrationTests.csproj
```

Run GitHub CLI-dependent integration tests:

```bash
WORKBENCH_RUN_GH_TESTS=1 dotnet test tests/Workbench.IntegrationTests/Workbench.IntegrationTests.csproj
```

Pack the .NET tool:

```bash
dotnet pack src/Workbench/Workbench.csproj -c Release
```

Publish a native binary (AOT):

```bash
dotnet publish src/Workbench/Workbench.csproj -c Release -r osx-arm64
```

Replace the runtime identifier with your target (e.g., `win-x64`, `linux-x64`).

Verification steps:

```bash
ls src/Workbench/bin/Release/net10.0/osx-arm64/publish
./src/Workbench/bin/Release/net10.0/osx-arm64/publish/workbench --help
```

Expected warnings:
- None. Treat any trimming/AOT warnings (IL2026/IL3050) as regressions.

## Documentation and contracts

- Docs overview: `docs/README.md`
- Work items: `docs/70-work/README.md`
- CLI help: `docs/30-contracts/cli-help.md`
- Schemas: `docs/30-contracts/`

## Voice commands

- `workbench voice workitem` records audio, transcribes it, and generates a work item.
- `workbench voice doc --type <spec|adr|doc|runbook|guide> [--out <path>] [--title "<...>"]` records audio, transcribes it, and generates a doc with YAML front matter.
- While recording, press ENTER to stop or ESC to cancel.

Requirements:
- Set `OPENAI_API_KEY` (or `WORKBENCH_AI_OPENAI_KEY`) for transcription.
- macOS: allow the terminal (or the built binary) in System Settings -> Privacy & Security -> Microphone.

Optional configuration:
- `WORKBENCH_AI_TRANSCRIPTION_MODEL` (default: `gpt-4o-mini-transcribe`)
- `WORKBENCH_AI_TRANSCRIPTION_LANGUAGE` (e.g., `en`)
- `WORKBENCH_VOICE_MAX_DURATION_SECONDS` (default: `240`)

Smoke test:
- Run `workbench voice workitem`, speak a short phrase, press ENTER, and confirm a work item file is created.

## Recording visualization

Workbench shows a small level meter/equalizer in the recording dialog.
In the TUI, open it with `F12` or `Ctrl+R` from the Work Items tab.

Optional knobs (env vars):
- `WORKBENCH_VOICE_VIZ_BANDS` (default: `12`)
- `WORKBENCH_VOICE_VIZ_UPDATE_HZ` (default: `20`)
- `WORKBENCH_VOICE_VIZ_FFT_SIZE` (default: `1024`)
- `WORKBENCH_VOICE_VIZ_LEVEL_BOOST` (default: `1.6`)
- `WORKBENCH_VOICE_VIZ_SPECTRUM` (default: `true`)

## Navigation

Generated by `workbench nav sync`.

<!-- workbench:root-index:start -->

### Quick links
- [Docs index](docs/README.md)
- [Work index](docs/70-work/README.md)

### Work item stats
| Metric | Count |
| --- | --- |
| Open | 3 |
| Closed | 1 |
| Total | 4 |

| Status | Count |
| --- | --- |
| ðŸŸ¡ draft | 3 |
| ðŸŸ¢ ready | 0 |
| ðŸ”µ in-progress | 0 |
| ðŸŸ¥ blocked | 0 |
| âœ… done | 1 |
| ðŸš« dropped | 0 |
<!-- workbench:root-index:end -->

## CI

GitHub Actions builds and tests on `ubuntu-latest`, `windows-latest`, and
`macos-latest` with .NET `10.0.x`:

```bash
dotnet build Workbench.slnx
dotnet test Workbench.slnx
```

## Contributing

- [Contribution guide](CONTRIBUTING.md)
- [Code of Conduct](CODE_OF_CONDUCT.md)
- [Security policy](SECURITY.md)
